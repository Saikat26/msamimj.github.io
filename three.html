<!doctype html>
<html>
    <head>
        
        <meta charset="utf-8">
        <title>NITS-Model</title>
        
        <script type="text/javascript" src="libs/three.js"></script>
        <script type="text/javascript" src="libs/OBJLoader.js"></script>
        <script type="text/javascript" src="libs/OrbitControls.js"></script>
        <script type="text/javascript" src="assets/terrain-data.js"></script>
        
        <style>
            body{
                margin: 0;
                overflow: hidden;
            }
        </style>
        
    </head>
        
    <body></body>
    
    <script type="text/javascript">
        
        var scene, camera, renderer, orbitControls, clock;
        
        var width = window.innerWidth;
        var height = window.innerHeight
        var aspectRatio = width/height;
        
        function init(){
            
            //Scene
            scene = new THREE.Scene();

            //Perspective Camera
            var fov = 45;            
            camera = new THREE.PerspectiveCamera(fov, aspectRatio, 1, 1000);
            camera.position.set(25,10,25);
            camera.lookAt(new THREE.Vector3(0,0,0));

            //WebGL Renderer
            renderer = new THREE.WebGLRenderer({antialias:true});
            renderer.setSize(width, height);
            renderer.setClearColor(0xdddddd);
            renderer.shadowMapEnabled = true;

            //Terrain
            var terrainMaterial = new THREE.MeshLambertMaterial({color:0xa67c52});
            terrainMaterial.side = THREE.DoubleSide;
            var terrainGeometry = new THREE.PlaneGeometry(30,20,29,19);
            for(var i=0; i<terrainGeometry.vertices.length; i++){
                terrainGeometry.vertices[i].z = zCoords[i]/40;
            }
            var terrain = new THREE.Mesh(terrainGeometry, terrainMaterial);
            terrain.rotation.x = -Math.PI * 0.5;
            terrain.rotation.z = Math.PI;
            terrain.receiveShadow = true;
            terrain.castShadow = true;
            scene.add(terrain);

            //OBJ Loader
            var loader = new THREE.OBJLoader();

            //Library
            loader.load('assets/minimalLibrary.obj', function(loadedMesh){

                var material = new THREE.MeshLambertMaterial({color: 0xeeeeee});
                material.side = THREE.DoubleSide;

                loadedMesh.children.forEach(function(child){
                    child.material = material;
                    child.geometry.computeFaceNormals();
                    child.geometry.computeVertexNormals();
                    child.castShadow = true;
                    child.receiveShadow = true;
                });
                
                loadedMesh.scale.set(1.2, 1.2, 1.2);
                loadedMesh.position.set(10, 2.7, -4)
                loadedMesh.rotation.y = Math.PI;
                scene.add(loadedMesh);

            });
            
            //Directional Light
            var directionalLight = new THREE.DirectionalLight('#eeeeee');
            directionalLight.position.set(-15, 25, 15);
            directionalLight.castShadow = true;
            directionalLight.shadowCameraNear = 2;
            directionalLight.shadowCameraFar = 200;
            directionalLight.shadowCameraLeft = -100;
            directionalLight.shadowCameraRight = 100;
            directionalLight.shadowCameraTop = 100;
            directionalLight.shadowCameraBottom = -100;

            directionalLight.distance = 0;
            directionalLight.intensity = 1;
            directionalLight.shadowMapHeight = 1024;
            directionalLight.shadowMapWidth = 1024;
            
            scene.add(directionalLight);
            
            //Orbit Controls
            orbitControls = new THREE.OrbitControls(camera);
//            orbitControls.autoRotate = true;
            clock = new THREE.Clock();

            //Add Renderer to DOM
            document.body.appendChild(renderer.domElement);
            
            //render
            render();
            
        }
        
        //Render Function
        function render(){
            requestAnimationFrame(render);
            
            var delta = clock.getDelta();
            orbitControls.update(delta);
            renderer.render(scene, camera);
        }
        
        //Window Onload
        window.onload  = init;
        
    </script>
    
</html>