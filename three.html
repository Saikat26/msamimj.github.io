<!doctype html>
<html>
    <head>
        
        <meta charset="utf-8">
        <title>NITS-Model</title>
        
        <script type="text/javascript" src="libs/three.js"></script>
        <script type="text/javascript" src="libs/OBJLoader.js"></script>
        <script type="text/javascript" src="libs/OrbitControls.js"></script>
        <script type="text/javascript" src="assets/terrain-data.js"></script>
        
        <style>
            body{
                margin: 0;
                overflow: hidden;
            }
        </style>
        
    </head>
        
    <body></body>
    
    <script type="text/javascript">
        
        var scene, camera, renderer, orbitControls, clock;
        
        var width = window.innerWidth;
        var height = window.innerHeight
        var aspectRatio = width/height;
        
        function init(){
            
            //Scene
            scene = new THREE.Scene();

            //Perspective Camera
            var fov = 45;            
            camera = new THREE.PerspectiveCamera(fov, aspectRatio, 1, 1000);
            camera.position.set(25,10,25);
            camera.lookAt(new THREE.Vector3(0,0,0));

            //WebGL Renderer
            renderer = new THREE.WebGLRenderer({antialias:true});
            renderer.setSize(width, height);
            renderer.setClearColor(0xdddddd);
            renderer.shadowMapEnabled = true;

            //Terrain
            var terrainMaterial = new THREE.MeshLambertMaterial({color:0xa67c52});
            terrainMaterial.side = THREE.DoubleSide;
            var terrainGeometry = new THREE.PlaneGeometry(45, 45, 29, 19);
//            for(var i=0; i<terrainGeometry.vertices.length; i++){
//                terrainGeometry.vertices[i].z = zCoords[i]/40;
//            }
            var terrain = new THREE.Mesh(terrainGeometry, terrainMaterial);
            terrain.rotation.x = -Math.PI * 0.5;
            terrain.rotation.z = Math.PI;
            terrain.position.y = 2.75;
            terrain.receiveShadow = true;
            terrain.castShadow = true;
            scene.add(terrain);
            
            var terrainBGeometry = new THREE.PlaneGeometry(45,30,1,1);
            var terrainB = new THREE.Mesh(terrainBGeometry, terrainMaterial);
            terrainB.rotation.x = -Math.PI * 0.5;
//            scene.add(terrainB);
            
            var roadMaterial = new THREE.MeshLambertMaterial({color:0xababab});
            
            var road1Geometry = new THREE.BoxGeometry(45, .2, 4.5);
            var road1 = new THREE.Mesh(road1Geometry, roadMaterial);
            road1.position.y = 2.75;
            road1.position.z = 6;
            scene.add(road1);
            
            var road2Geometry = new THREE.BoxGeometry(4.5, .2, 28.5);
            var road2 = new THREE.Mesh(road2Geometry, roadMaterial);
            road2.position.x = -12;
            road2.position.y = 2.75;
            road2.position.z = -8.25;
            scene.add(road2);

            //OBJ Loader
            var loader = new THREE.OBJLoader();

            //Library
            loader.load('assets/minimalLibrary.obj', function(loadedMesh){

                var material = new THREE.MeshLambertMaterial({color: 0xeeeeee});
                material.side = THREE.DoubleSide;

                loadedMesh.children.forEach(function(child){
                    child.material = material;
                    child.geometry.computeFaceNormals();
                    child.geometry.computeVertexNormals();
                    child.castShadow = true;
                    child.receiveShadow = true;
                });
                
                loadedMesh.scale.set(1.8, 1.8, 1.8);
                loadedMesh.position.set(15, 2.7, -6)
                loadedMesh.rotation.y = Math.PI;
                scene.add(loadedMesh);

            });
            
            //EBuilding
            loader.load('assets/minimalEBuilding.obj', function(loadedE){
                
                var material = new THREE.MeshLambertMaterial({color: 0xdddddd});
                material.side = THREE.DoubleSide;
                
                loadedE.children.forEach(function(child){
                    child.material = material;
                    child.geometry.computeFaceNormals();
                    child.geometry.computeVertexNormals();
                    child.castShadow = true;
                    child.receiveShadow = true;
                });
                
                loadedE.scale.set(1.5, 1.3, 1.5);
                loadedE.position.set(1.6, 2.8, -2)
                loadedE.rotation.y = 0.5 * Math.PI;
                scene.add(loadedE);
                
            });
            
            //8Building
            loader.load('assets/minimal8Building.obj', function(loaded8){
               
                var material = new THREE.MeshLambertMaterial({color: 0xdddddd});
                material.side = THREE.DoubleSide;
                
                loaded8.children.forEach(function(child){
                    child.material = material;
                    child.geometry.computeFaceNormals();
                    child.geometry.computeVertexNormals();
                    child.castShadow = true;
                    child.receiveShadow = true;
                });
                
                loaded8.scale.set(1.5, 1.5, 2);
                loaded8.position.set(-2, 2.8, -7);
                loaded8.rotation.y = 0.5 * Math.PI;
                scene.add(loaded8);
                
                var loaded82 = loaded8.clone();
                loaded8.scale.set(1.5, 1.5, 2);
                loaded8.position.set(6, 2.8, -14);
                loaded8.rotation.y = 0.5 * Math.PI;
                scene.add(loaded82)
                
            });
            
            //Directional Light
            var directionalLight = new THREE.DirectionalLight('#eeeeee');
            directionalLight.position.set(-15, 25, 15);
            directionalLight.castShadow = true;
            directionalLight.shadowCameraNear = 2;
            directionalLight.shadowCameraFar = 200;
            directionalLight.shadowCameraLeft = -100;
            directionalLight.shadowCameraRight = 100;
            directionalLight.shadowCameraTop = 100;
            directionalLight.shadowCameraBottom = -100;

            directionalLight.distance = 0;
            directionalLight.intensity = 1;
            directionalLight.shadowMapHeight = 1024;
            directionalLight.shadowMapWidth = 1024;
            
            scene.add(directionalLight);
            
            //Orbit Controls
            orbitControls = new THREE.OrbitControls(camera);
            orbitControls.autoRotate = true;
            clock = new THREE.Clock();

            //Add Renderer to DOM
            document.body.appendChild(renderer.domElement);
            
            //render
            render();
            
        }
        
        //Render Function
        function render(){
            requestAnimationFrame(render);
            
            var delta = clock.getDelta();
            orbitControls.update(delta);
            renderer.render(scene, camera);
        }
        
        //Window Onload
        window.onload  = init;
        
    </script>
    
</html>